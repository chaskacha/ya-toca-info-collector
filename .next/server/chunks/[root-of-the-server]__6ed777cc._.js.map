{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///Users/chaskacha/Desktop/projects/ya_toca/ya_toca_backup_info_collector/src/lib/session.ts"],"sourcesContent":["import { cookies } from 'next/headers';\n\n\nexport async function getOrSetSession(): Promise<string> {\n    const c = cookies();\n    const existing = (await c).get('ytc_sid')?.value;\n    if (existing) return existing;\n    const sid = crypto.randomUUID();\n    (await c).set('ytc_sid', sid, { httpOnly: true, sameSite: 'lax', path: '/', secure: true });\n    return sid;\n}"],"names":[],"mappings":";;;AAAA;;AAGO,eAAe;IAClB,MAAM,IAAI,CAAA,GAAA,iIAAA,CAAA,UAAO,AAAD;IAChB,MAAM,WAAW,CAAC,MAAM,CAAC,EAAE,GAAG,CAAC,YAAY;IAC3C,IAAI,UAAU,OAAO;IACrB,MAAM,MAAM,OAAO,UAAU;IAC7B,CAAC,MAAM,CAAC,EAAE,GAAG,CAAC,WAAW,KAAK;QAAE,UAAU;QAAM,UAAU;QAAO,MAAM;QAAK,QAAQ;IAAK;IACzF,OAAO;AACX","debugId":null}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["file:///Users/chaskacha/Desktop/projects/ya_toca/ya_toca_backup_info_collector/src/lib/store.ts"],"sourcesContent":["import { MessagePayload, Profile } from './types';\n\n\n// @ts-ignore\nconst g: any = global;\nif (!g.__YTC_STORE__) g.__YTC_STORE__ = { profiles: new Map<string, Profile>(), messages: new Map<string, MessagePayload[]>() };\n\n\nexport const mem = g.__YTC_STORE__ as { profiles: Map<string, Profile>; messages: Map<string, MessagePayload[]> };\n\n\nexport function upsertProfile(sessionId: string, mut: (p: Profile) => void) {\n    const curr = mem.profiles.get(sessionId) ?? {\n        sessionId,\n        phone: null,\n        cabildoName: null,\n        demographics: { gender: null, age: null, population: null, ethnicity: null, occupation: null, education: null, originRegion: null, cabildoRegion: null },\n        demographicsCompleted: false,\n        cabildoCompleted: false,\n        stationsDone: []\n    } satisfies Profile;\n    mut(curr);\n    mem.profiles.set(sessionId, curr);\n    return curr;\n}\n\n\nexport function getProfile(sessionId: string) {\n    return mem.profiles.get(sessionId) ?? null;\n}\n\n\nexport function pushMessage(sessionId: string, m: MessagePayload) {\n    const list = mem.messages.get(sessionId) ?? [];\n    list.push(m);\n    mem.messages.set(sessionId, list);\n}"],"names":[],"mappings":";;;;;;AAGA,aAAa;AACb,MAAM,IAAS;AACf,IAAI,CAAC,EAAE,aAAa,EAAE,EAAE,aAAa,GAAG;IAAE,UAAU,IAAI;IAAwB,UAAU,IAAI;AAAgC;AAGvH,MAAM,MAAM,EAAE,aAAa;AAG3B,SAAS,cAAc,SAAiB,EAAE,GAAyB;IACtE,MAAM,OAAO,IAAI,QAAQ,CAAC,GAAG,CAAC,cAAc;QACxC;QACA,OAAO;QACP,aAAa;QACb,cAAc;YAAE,QAAQ;YAAM,KAAK;YAAM,YAAY;YAAM,WAAW;YAAM,YAAY;YAAM,WAAW;YAAM,cAAc;YAAM,eAAe;QAAK;QACvJ,uBAAuB;QACvB,kBAAkB;QAClB,cAAc,EAAE;IACpB;IACA,IAAI;IACJ,IAAI,QAAQ,CAAC,GAAG,CAAC,WAAW;IAC5B,OAAO;AACX;AAGO,SAAS,WAAW,SAAiB;IACxC,OAAO,IAAI,QAAQ,CAAC,GAAG,CAAC,cAAc;AAC1C;AAGO,SAAS,YAAY,SAAiB,EAAE,CAAiB;IAC5D,MAAM,OAAO,IAAI,QAAQ,CAAC,GAAG,CAAC,cAAc,EAAE;IAC9C,KAAK,IAAI,CAAC;IACV,IAAI,QAAQ,CAAC,GAAG,CAAC,WAAW;AAChC","debugId":null}},
    {"offset": {"line": 134, "column": 0}, "map": {"version":3,"sources":["file:///Users/chaskacha/Desktop/projects/ya_toca/ya_toca_backup_info_collector/src/app/api/messages/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport { z } from 'zod';\nimport { getOrSetSession } from '@/lib/session';\nimport { getProfile, pushMessage, upsertProfile } from '@/lib/store';\n\n\nconst msgSchema = z.object({\ntype: z.enum(['free', 'station1', 'station2', 'station3', 'final']),\ntext: z.string().optional(),\nimages: z.array(z.object({ filename: z.string(), dataUrl: z.string().startsWith('data:') })).optional(),\naudio: z.object({ mime: z.string(), dataUrl: z.string().startsWith('data:'), durationMs: z.number().optional() }).nullable().optional(),\n});\n\n\nexport async function POST(req: Request) {\nconst sid = getOrSetSession();\nconst profile = getProfile(await sid);\nif (!profile?.demographicsCompleted) return NextResponse.json({ error: 'Onboarding required' }, { status: 403 });\n\n\nconst body = await req.json();\nconst parsed = msgSchema.safeParse(body);\nif (!parsed.success) return NextResponse.json({ error: parsed.error.format() }, { status: 400 });\nconst msg = parsed.data;\n\n\n// one submission per station\nif (msg.type.startsWith('station')) {\nconst stationNum = Number(msg.type.replace('station', ''));\nif (profile.stationsDone.includes(stationNum))\nreturn NextResponse.json({ error: 'Ya enviaste esta estaciÃ³n' }, { status: 409 });\nupsertProfile(await sid, (p) => { p.stationsDone = Array.from(new Set([...(p.stationsDone ?? []), stationNum])); });\n}\n\n\n// final word special case\nif (msg.type === 'final') {\nconst word = (msg.text ?? '').trim();\nupsertProfile(await sid, (p) => { p.finalWord = word; p.cabildoCompleted = true; });\n}\n\n\npushMessage(await sid, msg);\nreturn NextResponse.json({ ok: true });\n}"],"names":[],"mappings":";;;AAAA;AACA;AACA;AACA;;;;;AAGA,MAAM,YAAY,+KAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IAC3B,MAAM,+KAAA,CAAA,IAAC,CAAC,IAAI,CAAC;QAAC;QAAQ;QAAY;QAAY;QAAY;KAAQ;IAClE,MAAM,+KAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;IACzB,QAAQ,+KAAA,CAAA,IAAC,CAAC,KAAK,CAAC,+KAAA,CAAA,IAAC,CAAC,MAAM,CAAC;QAAE,UAAU,+KAAA,CAAA,IAAC,CAAC,MAAM;QAAI,SAAS,+KAAA,CAAA,IAAC,CAAC,MAAM,GAAG,UAAU,CAAC;IAAS,IAAI,QAAQ;IACrG,OAAO,+KAAA,CAAA,IAAC,CAAC,MAAM,CAAC;QAAE,MAAM,+KAAA,CAAA,IAAC,CAAC,MAAM;QAAI,SAAS,+KAAA,CAAA,IAAC,CAAC,MAAM,GAAG,UAAU,CAAC;QAAU,YAAY,+KAAA,CAAA,IAAC,CAAC,MAAM,GAAG,QAAQ;IAAG,GAAG,QAAQ,GAAG,QAAQ;AACrI;AAGO,eAAe,KAAK,GAAY;IACvC,MAAM,MAAM,CAAA,GAAA,uHAAA,CAAA,kBAAe,AAAD;IAC1B,MAAM,UAAU,CAAA,GAAA,qHAAA,CAAA,aAAU,AAAD,EAAE,MAAM;IACjC,IAAI,CAAC,SAAS,uBAAuB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QAAE,OAAO;IAAsB,GAAG;QAAE,QAAQ;IAAI;IAG9G,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,MAAM,SAAS,UAAU,SAAS,CAAC;IACnC,IAAI,CAAC,OAAO,OAAO,EAAE,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QAAE,OAAO,OAAO,KAAK,CAAC,MAAM;IAAG,GAAG;QAAE,QAAQ;IAAI;IAC9F,MAAM,MAAM,OAAO,IAAI;IAGvB,6BAA6B;IAC7B,IAAI,IAAI,IAAI,CAAC,UAAU,CAAC,YAAY;QACpC,MAAM,aAAa,OAAO,IAAI,IAAI,CAAC,OAAO,CAAC,WAAW;QACtD,IAAI,QAAQ,YAAY,CAAC,QAAQ,CAAC,aAClC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAA4B,GAAG;YAAE,QAAQ;QAAI;QAC/E,CAAA,GAAA,qHAAA,CAAA,gBAAa,AAAD,EAAE,MAAM,KAAK,CAAC;YAAQ,EAAE,YAAY,GAAG,MAAM,IAAI,CAAC,IAAI,IAAI;mBAAK,EAAE,YAAY,IAAI,EAAE;gBAAG;aAAW;QAAI;IACjH;IAGA,0BAA0B;IAC1B,IAAI,IAAI,IAAI,KAAK,SAAS;QAC1B,MAAM,OAAO,CAAC,IAAI,IAAI,IAAI,EAAE,EAAE,IAAI;QAClC,CAAA,GAAA,qHAAA,CAAA,gBAAa,AAAD,EAAE,MAAM,KAAK,CAAC;YAAQ,EAAE,SAAS,GAAG;YAAM,EAAE,gBAAgB,GAAG;QAAM;IACjF;IAGA,CAAA,GAAA,qHAAA,CAAA,cAAW,AAAD,EAAE,MAAM,KAAK;IACvB,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QAAE,IAAI;IAAK;AACpC","debugId":null}}]
}