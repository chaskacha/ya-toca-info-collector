{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 60, "column": 0}, "map": {"version":3,"sources":["file:///Users/chaskacha/Desktop/projects/ya_toca/ya_toca_backup_info_collector/src/lib/session.ts"],"sourcesContent":["import { cookies } from 'next/headers';\n\n\nexport async function getOrSetSession(): Promise<string> {\n    const c = cookies();\n    const existing = (await c).get('ytc_sid')?.value;\n    if (existing) return existing;\n    const sid = crypto.randomUUID();\n    (await c).set('ytc_sid', sid, { httpOnly: true, sameSite: 'lax', path: '/', secure: true });\n    return sid;\n}"],"names":[],"mappings":";;;AAAA;;AAGO,eAAe;IAClB,MAAM,IAAI,CAAA,GAAA,iIAAA,CAAA,UAAO,AAAD;IAChB,MAAM,WAAW,CAAC,MAAM,CAAC,EAAE,GAAG,CAAC,YAAY;IAC3C,IAAI,UAAU,OAAO;IACrB,MAAM,MAAM,OAAO,UAAU;IAC7B,CAAC,MAAM,CAAC,EAAE,GAAG,CAAC,WAAW,KAAK;QAAE,UAAU;QAAM,UAAU;QAAO,MAAM;QAAK,QAAQ;IAAK;IACzF,OAAO;AACX","debugId":null}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["file:///Users/chaskacha/Desktop/projects/ya_toca/ya_toca_backup_info_collector/src/lib/store.ts"],"sourcesContent":["import { MessagePayload, Profile } from './types';\n\n\n// @ts-ignore\nconst g: any = global;\nif (!g.__YTC_STORE__) g.__YTC_STORE__ = { profiles: new Map<string, Profile>(), messages: new Map<string, MessagePayload[]>() };\n\n\nexport const mem = g.__YTC_STORE__ as { profiles: Map<string, Profile>; messages: Map<string, MessagePayload[]> };\n\n\nexport function upsertProfile(sessionId: string, mut: (p: Profile) => void) {\n    const curr = mem.profiles.get(sessionId) ?? {\n        sessionId,\n        phone: null,\n        cabildoName: null,\n        demographics: { gender: null, age: null, population: null, ethnicity: null, occupation: null, education: null, originRegion: null, cabildoRegion: null },\n        demographicsCompleted: false,\n        cabildoCompleted: false,\n        stationsDone: []\n    } satisfies Profile;\n    mut(curr);\n    mem.profiles.set(sessionId, curr);\n    return curr;\n}\n\n\nexport function getProfile(sessionId: string) {\n    return mem.profiles.get(sessionId) ?? null;\n}\n\n\nexport function pushMessage(sessionId: string, m: MessagePayload) {\n    const list = mem.messages.get(sessionId) ?? [];\n    list.push(m);\n    mem.messages.set(sessionId, list);\n}"],"names":[],"mappings":";;;;;;AAGA,aAAa;AACb,MAAM,IAAS;AACf,IAAI,CAAC,EAAE,aAAa,EAAE,EAAE,aAAa,GAAG;IAAE,UAAU,IAAI;IAAwB,UAAU,IAAI;AAAgC;AAGvH,MAAM,MAAM,EAAE,aAAa;AAG3B,SAAS,cAAc,SAAiB,EAAE,GAAyB;IACtE,MAAM,OAAO,IAAI,QAAQ,CAAC,GAAG,CAAC,cAAc;QACxC;QACA,OAAO;QACP,aAAa;QACb,cAAc;YAAE,QAAQ;YAAM,KAAK;YAAM,YAAY;YAAM,WAAW;YAAM,YAAY;YAAM,WAAW;YAAM,cAAc;YAAM,eAAe;QAAK;QACvJ,uBAAuB;QACvB,kBAAkB;QAClB,cAAc,EAAE;IACpB;IACA,IAAI;IACJ,IAAI,QAAQ,CAAC,GAAG,CAAC,WAAW;IAC5B,OAAO;AACX;AAGO,SAAS,WAAW,SAAiB;IACxC,OAAO,IAAI,QAAQ,CAAC,GAAG,CAAC,cAAc;AAC1C;AAGO,SAAS,YAAY,SAAiB,EAAE,CAAiB;IAC5D,MAAM,OAAO,IAAI,QAAQ,CAAC,GAAG,CAAC,cAAc,EAAE;IAC9C,KAAK,IAAI,CAAC;IACV,IAAI,QAAQ,CAAC,GAAG,CAAC,WAAW;AAChC","debugId":null}},
    {"offset": {"line": 134, "column": 0}, "map": {"version":3,"sources":["file:///Users/chaskacha/Desktop/projects/ya_toca/ya_toca_backup_info_collector/src/app/api/profile/route.ts"],"sourcesContent":["import { cookies } from 'next/headers';\nimport { NextResponse } from 'next/server';\nimport { z } from 'zod';\nimport { getOrSetSession } from '@/lib/session';\nimport { upsertProfile, getProfile } from '@/lib/store';\n\n\nconst schema = z.object({\n    cabildoName: z.string().trim().min(1, 'Requerido'),\n    demographics: z.object({\n        gender: z.string(),\n        age: z.string(),\n        population: z.string(),\n        ethnicity: z.string(),\n        occupation: z.string(),\n        education: z.string(),\n        originRegion: z.string(),\n        cabildoRegion: z.string(),\n    }),\n    consent: z.enum(['yes', 'no']),\n    phone: z.string().trim().min(1, 'Requerido'),\n});\n\n\nexport async function GET() {\n    const sid = getOrSetSession();\n    const p = getProfile(await sid);\n    return NextResponse.json({ sessionId: sid, profile: p });\n}\n\n\nexport async function POST(req: Request) {\n    const sid = getOrSetSession();\n    const body = await req.json();\n    const parsed = schema.safeParse(body);\n    if (!parsed.success) return NextResponse.json({ error: parsed.error.format() }, { status: 400 });\n\n\n    const { cabildoName, demographics, consent, phone } = parsed.data;\n    const updated = upsertProfile(await sid, (p) => {\n        p.phone = phone;\n        p.cabildoName = 'UTEC';\n        p.demographics = demographics;\n        p.demographicsCompleted = true;\n        p.consent = consent;\n        p.demographics.originRegion = demographics.originRegion;\n        p.demographics.cabildoRegion = demographics.cabildoRegion;\n    });\n\n\n    // mark cookie to pass middleware gate\n    (await\n        // mark cookie to pass middleware gate\n        cookies()).set('ytc_onboarded', '1', { httpOnly: false, sameSite: 'lax', path: '/', secure: true });\n\n\n    return NextResponse.json({ ok: true, profile: updated });\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAGA,MAAM,SAAS,+KAAA,CAAA,IAAC,CAAC,MAAM,CAAC;IACpB,aAAa,+KAAA,CAAA,IAAC,CAAC,MAAM,GAAG,IAAI,GAAG,GAAG,CAAC,GAAG;IACtC,cAAc,+KAAA,CAAA,IAAC,CAAC,MAAM,CAAC;QACnB,QAAQ,+KAAA,CAAA,IAAC,CAAC,MAAM;QAChB,KAAK,+KAAA,CAAA,IAAC,CAAC,MAAM;QACb,YAAY,+KAAA,CAAA,IAAC,CAAC,MAAM;QACpB,WAAW,+KAAA,CAAA,IAAC,CAAC,MAAM;QACnB,YAAY,+KAAA,CAAA,IAAC,CAAC,MAAM;QACpB,WAAW,+KAAA,CAAA,IAAC,CAAC,MAAM;QACnB,cAAc,+KAAA,CAAA,IAAC,CAAC,MAAM;QACtB,eAAe,+KAAA,CAAA,IAAC,CAAC,MAAM;IAC3B;IACA,SAAS,+KAAA,CAAA,IAAC,CAAC,IAAI,CAAC;QAAC;QAAO;KAAK;IAC7B,OAAO,+KAAA,CAAA,IAAC,CAAC,MAAM,GAAG,IAAI,GAAG,GAAG,CAAC,GAAG;AACpC;AAGO,eAAe;IAClB,MAAM,MAAM,CAAA,GAAA,uHAAA,CAAA,kBAAe,AAAD;IAC1B,MAAM,IAAI,CAAA,GAAA,qHAAA,CAAA,aAAU,AAAD,EAAE,MAAM;IAC3B,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QAAE,WAAW;QAAK,SAAS;IAAE;AAC1D;AAGO,eAAe,KAAK,GAAY;IACnC,MAAM,MAAM,CAAA,GAAA,uHAAA,CAAA,kBAAe,AAAD;IAC1B,MAAM,OAAO,MAAM,IAAI,IAAI;IAC3B,MAAM,SAAS,OAAO,SAAS,CAAC;IAChC,IAAI,CAAC,OAAO,OAAO,EAAE,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QAAE,OAAO,OAAO,KAAK,CAAC,MAAM;IAAG,GAAG;QAAE,QAAQ;IAAI;IAG9F,MAAM,EAAE,WAAW,EAAE,YAAY,EAAE,OAAO,EAAE,KAAK,EAAE,GAAG,OAAO,IAAI;IACjE,MAAM,UAAU,CAAA,GAAA,qHAAA,CAAA,gBAAa,AAAD,EAAE,MAAM,KAAK,CAAC;QACtC,EAAE,KAAK,GAAG;QACV,EAAE,WAAW,GAAG;QAChB,EAAE,YAAY,GAAG;QACjB,EAAE,qBAAqB,GAAG;QAC1B,EAAE,OAAO,GAAG;QACZ,EAAE,YAAY,CAAC,YAAY,GAAG,aAAa,YAAY;QACvD,EAAE,YAAY,CAAC,aAAa,GAAG,aAAa,aAAa;IAC7D;IAGA,sCAAsC;IACtC,CAAC,MACG,sCAAsC;IACtC,CAAA,GAAA,iIAAA,CAAA,UAAO,AAAD,GAAG,EAAE,GAAG,CAAC,iBAAiB,KAAK;QAAE,UAAU;QAAO,UAAU;QAAO,MAAM;QAAK,QAAQ;IAAK;IAGrG,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;QAAE,IAAI;QAAM,SAAS;IAAQ;AAC1D","debugId":null}}]
}