(()=>{var e={};e.id=434,e.ids=[434],e.modules={846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2807:(e,t,s)=>{"use strict";s.r(t),s.d(t,{patchFetch:()=>_,routeModule:()=>m,serverHooks:()=>x,workAsyncStorage:()=>g,workUnitAsyncStorage:()=>f});var r={};s.r(r),s.d(r,{POST:()=>d});var a=s(6559),o=s(8088),n=s(7719),i=s(2190),l=s(1067),u=s(8623),p=s(3450);let c=l.Ikc({type:l.k5n(["station1","station2","station3","final"]),text:l.YjP().optional(),images:l.YOg(l.Ikc({filename:l.YjP(),dataUrl:l.YjP().startsWith("data:")})).optional(),audio:l.Ikc({mime:l.YjP(),dataUrl:l.YjP().startsWith("data:"),durationMs:l.aig().optional()}).nullable().optional()});async function d(e){let t=(0,u.w)(),s=(0,p.E$)(await t);if(!s?.demographicsCompleted)return i.NextResponse.json({error:"Onboarding required"},{status:403});let r=await e.json(),a=c.safeParse(r);if(!a.success)return i.NextResponse.json({error:a.error.format()},{status:400});let o=a.data;if(o.type.startsWith("station")){let e=Number(o.type.replace("station",""));(0,p.Vf)(await t,t=>{t.stationsDone.includes(e)||(t.stationsDone=[...t.stationsDone,e].sort((e,t)=>e-t))})}if("final"===o.type){let e=(o.text??"").trim();(0,p.Vf)(await t,t=>{t.finalWord=e,t.cabildoCompleted=!0})}return(0,p.ct)(await t,o),i.NextResponse.json({ok:!0})}let m=new a.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/messages/route",pathname:"/api/messages",filename:"route",bundlePath:"app/api/messages/route"},resolvedPagePath:"/Users/chaskacha/Desktop/projects/ya_toca/ya_toca_backup_info_collector/src/app/api/messages/route.ts",nextConfigOutput:"",userland:r}),{workAsyncStorage:g,workUnitAsyncStorage:f,serverHooks:x}=m;function _(){return(0,n.patchFetch)({workAsyncStorage:g,workUnitAsyncStorage:f})}},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3450:(e,t,s)=>{"use strict";s.d(t,{E$:()=>n,Vf:()=>o,ct:()=>i});let r=global;r.__YTC_STORE__||(r.__YTC_STORE__={profiles:new Map,messages:new Map});let a=r.__YTC_STORE__;function o(e,t){let s=a.profiles.get(e)??{sessionId:e,phone:null,cabildoName:null,demographics:{gender:null,age:null,population:null,ethnicity:null,occupation:null,education:null,originRegion:null,cabildoRegion:null},demographicsCompleted:!1,cabildoCompleted:!1,stationsDone:[]};return t(s),a.profiles.set(e,s),s}function n(e){return a.profiles.get(e)??null}function i(e,t){let s=a.messages.get(e)??[];s.push({...t,_id:crypto.randomUUID(),_ts:Date.now()}),a.messages.set(e,s)}},4870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5511:e=>{"use strict";e.exports=require("crypto")},6487:()=>{},8335:()=>{},8623:(e,t,s)=>{"use strict";s.d(t,{w:()=>n});var r=s(4999),a=s(5511),o=s.n(a);async function n(){let e=(0,r.UL)(),t=(await e).get("yt_sid")?.value;return t||(t=o().randomUUID(),(await e).set("yt_sid",t,{httpOnly:!0,sameSite:"lax",path:"/",secure:!0,maxAge:604800})),t}},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[719,580,329],()=>s(2807));module.exports=r})();