(()=>{var e={};e.id=654,e.ids=[654],e.modules={217:(e,t,r)=>{"use strict";r.d(t,{A:()=>c});var a=r(687),s=r(3210),n=r(2914),o=r(6189);function i({onReady:e,maxMs:t=12e4,disabled:r,label:n="Audio"}){let[o,i]=(0,s.useState)("idle"),[c,l]=(0,s.useState)(!1),[u,d]=(0,s.useState)(null),[p,m]=(0,s.useState)("audio/webm"),[h,f]=(0,s.useState)(0),[x,_]=(0,s.useState)(null),b=(0,s.useRef)(null),v=(0,s.useRef)(null),y=(0,s.useRef)([]),w=(0,s.useRef)(null),g=(0,s.useRef)(null),j=(0,s.useRef)(null),R=(0,s.useRef)(null),k=(0,s.useRef)(null),S=(0,s.useRef)(null);(0,s.useRef)(null);let N=(0,s.useRef)(null),[P]=(0,s.useState)("undefined"==typeof MediaRecorder?"":["audio/mp4;codecs=mp4a.40.2","audio/aac","audio/webm;codecs=opus","audio/webm"].find(e=>MediaRecorder.isTypeSupported(e))||"");async function A(){if(!r&&!c&&"recording"!==o){d(null),l(!0);try{let e=await navigator.mediaDevices.getUserMedia({audio:!0});v.current=e,j.current=new(window.AudioContext||window.webkitAudioContext),R.current=j.current.createAnalyser(),R.current.fftSize=1024,k.current=j.current.createMediaStreamSource(e),k.current.connect(R.current),function(){if(!g.current||!R.current)return;let e=g.current,t=e.getContext("2d"),r=e.width=e.clientWidth,a=e.height=e.clientHeight,s=R.current.frequencyBinCount,n=new Uint8Array(s),o=()=>{R.current.getByteTimeDomainData(n),t.clearRect(0,0,r,a),t.lineWidth=2,t.strokeStyle="#fff",t.beginPath();let e=r/s;for(let r=0;r<s;r++){let s=n[r]/128*a/2,o=r*e;0===r?t.moveTo(o,s):t.lineTo(o,s)}t.stroke(),S.current=requestAnimationFrame(o)};o()}(),y.current=[];let r=new MediaRecorder(e,P?{mimeType:P,audioBitsPerSecond:128e3}:void 0);b.current=r,r.ondataavailable=e=>{e.data.size&&y.current.push(e.data)},r.onstop=()=>{},r.start(250),i("recording"),f(0);let a=Date.now();w.current=window.setInterval(()=>{let e=Date.now()-a;f(e),e>=t&&T()},200)}catch(e){d(e?.message||"No se pudo acceder al micr\xf3fono"),E(),i("idle")}finally{l(!1)}}}function C(){b.current&&"inactive"!==b.current.state&&b.current.stop(),E(),i("idle"),f(0)}async function T(){let e=b.current;if(!e)return;await new Promise(t=>{let r=()=>{e.removeEventListener("stop",r),t()};e.addEventListener("stop",r);try{e.stop()}catch{}});let t=e.mimeType||P||"audio/webm",r=y.current.slice();y.current=[];let a=new Blob(r,{type:t});if(!a.size){d("No se captur\xf3 audio. Intenta de nuevo."),C();return}let s=/mp4|aac/.test(a.type)?"m4a":"webm",n=new File([a],`audio-${Date.now()}.${s}`,{type:a.type}),o=URL.createObjectURL(a);E(),_(e=>(e&&URL.revokeObjectURL(e),o)),N.current=n,m(a.type),i("preview")}function E(){if(w.current&&(clearInterval(w.current),w.current=null),S.current&&(cancelAnimationFrame(S.current),S.current=null),k.current){try{k.current.disconnect()}catch{}k.current=null}if(R.current&&(R.current.disconnect(),R.current=null),j.current){try{j.current.close()}catch{}j.current=null}b.current=null,v.current&&(v.current.getTracks().forEach(e=>e.stop()),v.current=null)}let q=(0,s.useRef)(null);return(0,a.jsxs)("div",{className:"wa-audio",children:[(0,a.jsx)("label",{className:"wa-audio__label fs24",children:n}),u&&(0,a.jsx)("div",{className:"wa-audio__error",children:u}),"idle"===o&&(0,a.jsxs)("div",{className:"wa-audio__row",children:[(0,a.jsx)("button",{type:"button",className:"wa-audio__mic",onMouseDown:A,onTouchStart:A,disabled:r||c,"aria-label":"Grabar",title:"Toca y habla",children:(0,a.jsx)("span",{className:"wa-audio__mic-icon",children:"\uD83C\uDF99️"})}),(0,a.jsx)("span",{className:"wa-audio__hint",children:"Toca para grabar"})]}),"recording"===o&&(0,a.jsxs)("div",{className:"wa-audio__recording",children:[(0,a.jsx)("div",{className:"wa-audio__pulse","aria-hidden":!0}),(0,a.jsx)("span",{className:"wa-audio__timer",children:function(e){let t=Math.floor(e/1e3),r=Math.floor(t/60);return`${String(r).padStart(1,"0")}:${String(t%60).padStart(2,"0")}`}(h)}),(0,a.jsx)("canvas",{ref:g,className:"wa-audio__wave"}),(0,a.jsxs)("div",{className:"wa-audio__actions",children:[(0,a.jsx)("button",{type:"button",className:"wa-audio__btn stop",onClick:T,children:"Terminar"}),(0,a.jsx)("button",{type:"button",className:"wa-audio__btn cancel",onClick:C,children:"Cancelar"})]})]}),"preview"===o&&x&&(0,a.jsxs)("div",{className:"wa-audio__preview",children:[(0,a.jsxs)("audio",{ref:q,controls:!0,playsInline:!0,preload:"metadata",className:"wa-audio__player",onLoadedMetadata:e=>console.log("duration",e.currentTarget.duration),onError:e=>console.warn("audio error",e.currentTarget.error),children:[(0,a.jsx)("source",{src:x,type:p||"audio/mp4"}),"Tu navegador no puede reproducir este audio."]},x),(0,a.jsx)("div",{className:"wa-audio__actions",children:(0,a.jsx)("button",{type:"button",className:"wa-audio__btn cancel",onClick:function(){x&&(URL.revokeObjectURL(x),_(null)),i("idle"),f(0)},children:"Eliminar"})})]})]})}function c({kind:e,placeholder:t,num:r,textareaRef:c}){let[l,u]=(0,s.useState)(""),[d,p]=(0,s.useState)([]),[m,h]=(0,s.useState)(null),[f,x]=(0,s.useState)(!1);(0,s.useRef)(null),(0,s.useRef)([]);let[_,b]=(0,s.useState)(!1),v=(0,o.useRouter)(),y=async()=>{x(!0);try{let t={type:e,text:l.trim()||void 0,images:d.length?d:void 0,audio:m?.file?m?.file:void 0},r=await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await r.json();if(!r.ok)throw Error(a.error||"Error");return u(""),p([]),h(null),{status:"success",message:"\xa1Enviado correctamente!"}}catch(e){return{status:"error",message:e.message||"Error"}}finally{x(!1);let e=localStorage.getItem("yt_stations_done")||"[]",t=new Set(Array.isArray(JSON.parse(e))?JSON.parse(e):[]);t.add(r),localStorage.setItem("yt_stations_done",JSON.stringify(Array.from(t).sort())),v.replace(3===r?"/cabildos/final-message":"/")}};return(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("textarea",{ref:c,className:"input w100",placeholder:t??"Escribe aqu\xed… (puedes usar emojis)",value:l,onChange:e=>u(e.target.value)}),(0,a.jsx)(i,{label:"Audio",onReady:(e,t,r)=>{h({file:e,url:t,mime:r})}}),(0,a.jsx)("br",{}),(0,a.jsx)(n.A,{label:"Enviar",onAction:y,disabled:f,height:48}),(0,a.jsx)("br",{})]})}},668:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var a=r(687),s=r(217),n=r(9159),o=r(3172),i=r(3210);function c(){let e={0:(0,i.useRef)(null),1:(0,i.useRef)(null),2:(0,i.useRef)(null)};return(0,a.jsx)(o.default,{children:(0,a.jsx)("div",{className:"admin-topics",children:(0,a.jsx)(n.default,{mv:32,children:(0,a.jsxs)("div",{className:"card space-y-3",children:[(0,a.jsx)("h2",{className:"thunder-fw-bold-lc fs48 uppercase",children:"Estaci\xf3n 3: El Presidente"}),(0,a.jsxs)("p",{className:"help fs24",children:["Cu\xe9ntanos c\xf3mo te sentiste despu\xe9s de la conversaci\xf3n. Puedes hacerlo como quieras: texto, audio, emoji, lo que mejor te salga. Habla como si se lo contaras a un/a amigo/a. Aqu\xed van unas preguntas para inspirarte:",(0,a.jsx)("div",{children:"- Si fueras presidente/a, \xbfqu\xe9 har\xedas para no decepcionar a tu generaci\xf3n?"}),(0,a.jsx)("div",{children:"- \xbfCu\xe1les ser\xedan tus prioridades?"})]}),(0,a.jsx)("br",{}),(0,a.jsx)(s.A,{kind:"station3",num:3,textareaRef:e[2]})]})})})})}},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},2914:(e,t,r)=>{"use strict";r.d(t,{A:()=>n});var a=r(687),s=r(3210);function n({label:e,onAction:t,className:r="",style:n,disabled:o,height:i=48,autoHideMs:c=4e3}){let[l,u]=(0,s.useState)(!1),[d,p]=(0,s.useState)(null),m=async()=>{if(!l&&!o){u(!0);try{let e=await t()??{status:"success",message:"Listo."};p({type:e.status,text:e.message})}catch(e){p({type:"error",text:e?.message||"Ocurri\xf3 un error."})}finally{setTimeout(()=>{u(!1),c&&setTimeout(()=>p(null),c)},2e3)}}};return(0,a.jsxs)("div",{className:"mb24",children:[(0,a.jsx)("button",{className:`btn w100 fw700 fs16 uppercase ${r}`,style:{height:i,...n},onClick:m,disabled:o||l,children:l?"Enviando...":e}),d&&(0,a.jsx)("div",{className:`notice ${d.type}`,role:"status","aria-live":"polite",style:{marginTop:8},children:d.text})]})}},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3357:(e,t,r)=>{Promise.resolve().then(r.bind(r,668))},3873:e=>{"use strict";e.exports=require("path")},4566:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>a});let a=(0,r(2907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"/Users/chaskacha/Desktop/projects/ya_toca/ya_toca_backup_info_collector/src/app/cabildos/station-three/page.tsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"/Users/chaskacha/Desktop/projects/ya_toca/ya_toca_backup_info_collector/src/app/cabildos/station-three/page.tsx","default")},6006:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>o.a,__next_app__:()=>d,pages:()=>u,routeModule:()=>p,tree:()=>l});var a=r(5239),s=r(8088),n=r(8170),o=r.n(n),i=r(893),c={};for(let e in i)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>i[e]);r.d(t,c);let l={children:["",{children:["cabildos",{children:["station-three",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,4566)),"/Users/chaskacha/Desktop/projects/ya_toca/ya_toca_backup_info_collector/src/app/cabildos/station-three/page.tsx"]}]},{}]},{metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]},{layout:[()=>Promise.resolve().then(r.bind(r,4431)),"/Users/chaskacha/Desktop/projects/ya_toca/ya_toca_backup_info_collector/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,7398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,9999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,5284,23)),"next/dist/client/components/unauthorized-error"],metadata:{icon:[async e=>(await Promise.resolve().then(r.bind(r,440))).default(e)],apple:[],openGraph:[],twitter:[],manifest:void 0}}]}.children,u=["/Users/chaskacha/Desktop/projects/ya_toca/ya_toca_backup_info_collector/src/app/cabildos/station-three/page.tsx"],d={require:r,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:s.RouteKind.APP_PAGE,page:"/cabildos/station-three/page",pathname:"/cabildos/station-three",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:l}})},6093:(e,t,r)=>{Promise.resolve().then(r.bind(r,4566))},6189:(e,t,r)=>{"use strict";var a=r(5773);r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9551:e=>{"use strict";e.exports=require("url")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[719,825,658,87],()=>r(6006));module.exports=a})();